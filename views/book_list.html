{{template "header" .}}

<style>
     #publish_time,#rli,.input-group-addon{
         background-color: #fff !important;
     }
</style>

<div class="container" style="margin-top:50px;">
  <div class="panel">
    <div class="panel-heading">
        <button class="btn btn-success" data-toggle="modal" data-target="#myModal">添加</button>
    </div>
    <div class="panel-body">
        <table class="table table-hover table-bordered">
            <thead>

              <tr>
                <th>图书编号</th>
                <th>书名</th>
                <th>作者</th>
                <th>价格</th>
                <th>库存</th>
                <th>出版日期</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>

                
                    
            
                {{range .}}
              <tr>
                <th scope="row">{{.book_id}}</th>
                <td>{{.book_name}}</td>
                <td>{{.book_author}}</td>
                <td>{{.book_price}}</td>
                <td>{{.book_stocknum}}</td>
                <td>{{.book_publishtime}}</td>
                <td>
                  <!-- <a href=""></a> -->
                      <button class="btn btn-success edit_book" edit_id={{.book_id}} data-toggle="Modal" data-target="#editModal">修改</button>
                  <!-- </a> -->
                  <a href="/delete_book?book_id={{.book_id}}">
                      <button class="btn btn-danger delete_book" value="">删除</button>
                  </a>
              </td>
              </tr>
              {{end}}
            </tbody>
        </table>
    </div>

   

  </div>
   
</div>
<!-- 模态框（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">添加书籍</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" method="POST" action="/book_add">
                    <div class="form-group">
                      <label for="book-id" class="col-sm-2 control-label" style="margin-left:20px;">书籍ID:</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" id="book-id" placeholder="书籍唯一标识" name="book_id">
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="book-price" class="col-sm-2 control-label" style="margin-left:20px;">价格:</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" id="book-price" placeholder="价格" name="price">
                      </div>
                    </div>
                    <div class="form-group">
                        <label for="book-author" class="col-sm-2 control-label" style="margin-left:20px;">作者:</label>
                        <div class="col-sm-9">
                          <input type="text" class="form-control" id="book-author" placeholder="作者" name="author">
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="book-name" class="col-sm-2 control-label" style="margin-left:20px;">书籍名称:</label>
                        <div class="col-sm-9">
                          <input type="text" class="form-control" id="book-name" placeholder="书名" name="book_name">
                        </div>
                      </div>
                      <!-- <div class="form-group">
                          <label for="publish-time" class="col-sm-2 control-label" style="margin-left:20px;">出版日期:</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="publish-time" placeholder="出版日期" name="publish_time">
                          </div>
                        </div> -->

                        
                        
                        <div class="form-group">
                          <label for="add-num" class="col-sm-2 control-label" style="margin-left:20px;">添加数量:</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="add-num" placeholder="添加数量" name="add_num">
                          </div>
                        </div>

                        <div class="form-group">
                                <label for="add-num" class="col-sm-2 control-label " style="margin-left:20px;">出版日期:</label>
                                <div class="input-group date form_date" data-date="" data-date-format="dd MM yyyy"
                                 data-link-field="dtp_input2" data-link-format="yyyy-mm-dd" style="width:433px;padding-left:15px;">
                                    <input class="form-control" type="text" value="" id="rli" readonly
                                       placeholder="请选择日期" name="publish_time">
                                    <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                                </div>
                                <input type="hidden" id="dtp_input2" value=""/><br/>
                            </div>


                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                            <button type="submit" class="btn btn-primary">提交更改</button>
                        </div>
      
                  </form>

            </div>
            
        </div>
    </div>
</div>

<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">添加书籍</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal">
                        <div class="form-group">
                          <label for="book-id" class="col-sm-2 control-label" style="margin-left:20px;">书籍ID:</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="book_id" placeholder="书籍唯一标识" name="book_id">
                          </div>
                        </div>
                        <div class="form-group">
                          <label for="book-price" class="col-sm-2 control-label" style="margin-left:20px;">价格:</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="book_price" placeholder="价格" name="price">
                          </div>
                        </div>
                        <div class="form-group">
                            <label for="book-author" class="col-sm-2 control-label" style="margin-left:20px;">作者:</label>
                            <div class="col-sm-9">
                              <input type="text" class="form-control" id="book_author" placeholder="作者" name="author">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="book-name" class="col-sm-2 control-label" style="margin-left:20px;">书籍名称:</label>
                            <div class="col-sm-9">
                              <input type="text" class="form-control" id="book_name" placeholder="书名" name="book_name">
                            </div>
                          </div>
                          <!-- <div class="form-group">
                              <label for="publish-time" class="col-sm-2 control-label" style="margin-left:20px;">出版日期:</label>
                              <div class="col-sm-9">
                                <input type="text" class="form-control" id="publish-time" placeholder="出版日期" name="publish_time">
                              </div>
                            </div> -->
    
                            
                            
                            <div class="form-group">
                              <label for="add-num" class="col-sm-2 control-label" style="margin-left:20px;">添加数量:</label>
                              <div class="col-sm-9">
                                <input type="text" class="form-control" id="add_num" placeholder="添加数量" name="add_num">
                              </div>
                            </div>
    
                            <div class="form-group">
                                    <label for="add-num" class="col-sm-2 control-label " style="margin-left:20px;">出版日期:</label>
                                    <div class="input-group date form_date" data-date="" data-date-format="dd MM yyyy"
                                     data-link-field="dtp_input2" data-link-format="yyyy-mm-dd" style="width:433px;padding-left:15px;">
                                        <input class="form-control" type="text" value="" id="publish_time" readonly
                                           placeholder="请选择日期" name="publish_time">
                                        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                                    </div>
                                    <input type="hidden" id="dtp_input2" value=""/><br/>
                                </div>
    
    
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                <button type="button" class="btn btn-primary" id="modify">提交更改</button>
                            </div>
          
                      </form>
    
                </div>
                
            </div>
        </div>
    </div>


<script type="text/javascript" src="/static/bootstrap-3.3.7-dist/js/bootstrap-datetimepicker.js"></script>
<script type="text/javascript" src="/static/bootstrap-3.3.7-dist/js/bootstrap-datetimepicker.zh-CN.js"></script>
<script>
      // 对Date的扩展，将 Date 转化为指定格式的String
    // 月(M)、日(d)、小时(h)、分(m)、秒(s)、季度(q) 可以用 1-2 个占位符，
    // 年(y)可以用 1-4 个占位符，毫秒(S)只能用 1 个占位符(是 1-3 位的数字)
    // 例子：
    // (new Date()).Format("yyyy-MM-dd hh:mm:ss.S") ==> 2006-07-02 08:09:04.423
    // (new Date()).Format("yyyy-M-d h:m:s.S")      ==> 2006-7-2 8:9:4.18
    Date.prototype.Format = function (fmt) { //author: meizz
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "h+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    };
    SELECT_ROOM = {"DEL": {}, "ADD": {}};
    CHOSE_DATE = new Date().Format("yyyy:MM:dd");
    //页面加载的时候就执行
    $(function () {
        initDatePicker();
    });
    // 初始化时间插件
    function initDatePicker() {
        $('.form_date').datetimepicker({
            format: 'yyyy:mm:dd',
            language: 'zh-CN',
            bootcssVer: 3,//bootstrap3,避免小图标不出现,好像没什么卵用
            weekStart: 1,
            // startDate: new Date(), //起始时间
            todayBtn: 1,
            // autoclose: 1, //是否自动关闭
            todayHighlight: 1,
            startView: 2,
            minView: 2,
            forceParse: 0
        });
    }
    // 时间插件change函数
    // function changeDate(ev) {
    //     CHOSE_DATE = ev.date.Format('yyyy:MM:dd');
    //     initBookInfo(CHOSE_DATE)
    // }

    //编辑书籍
    $(".edit_book").click(function(){
       
        var book_id = $(this).attr('edit_id')
        $.ajax({
            url:"/edit_book",
            type:"GET",
            data:{
                "book_id":book_id,
            },
            success:function(data){
                console.log(data)
                $('#book_id').attr('value',data.book_id).attr('disabled','true')
                $('#book_name').attr('value',data.book_name)
                $('#book_price').attr('value',data.book_price)
                $('#book_author').attr('value',data.book_author)
                $('#publish_time').attr('value',data.book_publishtime)
                $('#add_num').attr('value',data.book_stocknum)

                $('#editModal').modal('show')
                     
            }
            
        })
    })

    $('#modify').click(function(){
        var book_id = $('#book_id').attr('value')
        var book_name = $('#book_name').attr('value')
        var book_price = $('#book_price').attr('value')
        var book_author = $('#book_author').attr('value')
        var book_publishtime = $('#publish_time').attr('value')
        var book_stocknum = $('#add_num').attr('value')

        $.ajax({
            url:"/update_book",
            type:"POST",
            data:{
                "book_id":book_id,
                "book_name":book_name,
                "price":book_price,
                "publish_time":book_publishtime,
                "add_num":book_stocknum,
                "author":book_author,
            },
            success:function(data){
                window.location.reload()
            }
        })

    })



</script>
</body>
</html>